# OLX Command Center

## 1. Цел на проекта
Основната цел на **OLX Command Center** е да предостави мощен, централизиран уеб интерфейс за управление на комуникацията с клиенти в OLX.
Проектът надхвърля простата автоматизация и се стреми да създаде инструмент, който улеснява обработката на съобщения, помага при формулирането на отговори чрез AI и дава възможност за анализ на комуникацията.

Системата е проектирана като „агент на повикване“, където човешкият оператор запазва пълен контрол, но разполага с мощни AI инструменти за оптимизиране на работата си.

## 2. Основни функционалности
- **Централизиран чат интерфейс** – показва всички разговори от OLX в двуколонен изглед, подобен на стандартните чат приложения.
- **AI асистент за отговори** – генерира предложения за отговор, използвайки пълния контекст на разговора и информацията за обявата.
- **AI анализатор на разговори** – операторът може да задава въпроси на AI относно текущия разговор (напр. „Какъв е телефонният номер на клиента?“).
- **Групови съобщения** – изпращане на еднакво съобщение до множество избрани потребители.
- **Управление на AI** – лесна промяна и запазване на системния промпт за адаптиране към специфичния тон и стил на комуникация.
- **Тъмна тема** – избор между светла и тъмна визуализация за по-комфортна работа.

## 3. Архитектура
Проектът е изграден върху евтина и лесна за поддръжка „serverless“ архитектура и се състои от три основни компонента.

### Frontend (потребителски интерфейс)
- **Технология:** HTML, CSS и JavaScript (Vanilla JS), хостнати безплатно на GitHub Pages.
- **Роля:** Визуалният интерфейс, използван в браузъра. Не съдържа чувствителна информация и комуникира с бекенда чрез API заявки.

### Backend (API сървър)
- **Технология:** Cloudflare Worker.
- **Роля:** Сигурен посредник между интерфейса и външните услуги. Отговаря за:
  - OAuth2 оторизация с OLX.
  - Сигурно съхранение и опресняване на API токени.
  - Приемане на заявки от интерфейса.
  - Комуникация с OLX Partner API и Google Gemini API.
  - Използване на Cloudflare KV за съхранение на токени и системния промпт.

### Външни услуги
- **OLX Partner API** – достъп до разговори, съобщения, обяви и изпращане на отговори.
- **Google Gemini API** – AI функционалности за генериране на отговори и анализ на текст.

```mermaid
graph TD
    A[Потребител в браузър] --> B{Frontend (index.html @ GitHub Pages)};
    B --> |API заявки (fetch)| C[Backend (worker.js @ Cloudflare)];
    C --> |OAuth2 & Partner API| D[OLX API];
    C --> |Генериране на текст| E[Google Gemini API];
    C <--> |Съхранение на токени/промпт| F[Cloudflare KV];
```

## 4. Инсталация и настройка
### Необходими неща
- GitHub акаунт – за хостинг на `index.html`.
- Cloudflare акаунт – за хостинг на `worker.js`.
- Достъп до OLX Partner API – Client ID и Client Secret.
- Достъп до Google AI Studio – Gemini API Key.

### Стъпка 1: Настройка на Backend (Cloudflare Worker)
1. Влезте в Cloudflare и създайте нов Worker от секция **Workers & Pages**.
2. Копирайте съдържанието на `worker.js` в редактора.
3. Създайте KV Namespace с име **OLX_TOKENS** и го свържете към Worker-а:
   - *Variable name:* `OLX_TOKENS`
   - *KV namespace:* `OLX_TOKENS`
4. Добавете Secrets (Environment Variables):
   - `OLX_CLIENT_ID` – вашият ID от OLX.
   - `OLX_CLIENT_SECRET` – тайният ключ от OLX.
   - `GEMINI_API_KEY` – ключ от Google AI Studio.
5. Deploy-нете Worker-а.

### Стъпка 2: Настройка на Frontend (GitHub Pages)
1. Създайте ново публично репозитори в GitHub (напр. `olx-dashboard`).
2. Качете файла `index.html` в репозиторито.
3. В настройките (**Settings → Pages**) активирайте GitHub Pages:
   - *Source:* Deploy from a branch.
   - *Branch:* `main`, *Folder:* `/ (root)`.
4. Получен URL ще изглежда като `https://your-username.github.io/olx-dashboard/`.

### Стъпка 3: Финална конфигурация в OLX
1. Влезте в контролния панел за разработчици на OLX и изберете вашето приложение.
2. В полето **Redirect URI** въведете точния URL на Worker-а, последван от `/callback` (напр. `https://your-worker.workers.dev/callback`).
3. В полето **Privacy Policy URL** добавете линк към `privacy.html` от GitHub Pages.

### Стъпка 4: Първоначална оторизация
1. Отворете вашия GitHub Pages URL.
2. При грешка за оторизация изберете „Оторизирайте се отново“, влезте в OLX и дайте съгласие.
3. След пренасочване към интерфейса системата е готова за работа.

## 5. API на Worker-а
| Метод | Път | Описание | Тяло на заявката (JSON) |
|-------|-----|----------|-------------------------|
| GET | `/api/threads` | Взима списък с последните 50 разговора | – |
| GET | `/api/threads/:id/messages` | Взима всички съобщения за даден разговор | – |
| POST | `/api/threads/:id/send-message` | Изпраща ново съобщение в даден разговор | `{ "text": "Вашето съобщение" }` |
| POST | `/api/broadcast` | Изпраща съобщение до множество разговори | `{ "threadIds": [1,2,3], "text": "..." }` |
| POST | `/api/generate-reply` | Генерира AI отговор за даден разговор | `{ "threadId": 123 }` |
| POST | `/api/analyze-thread` | Задава въпрос на AI за даден разговор | `{ "threadId": 123, "question": "..." }` |
| GET | `/api/prompt` | Взима текущия системен промпт от KV | – |
| POST | `/api/prompt` | Записва нов системен промпт в KV | `{ "prompt": "Новият промпт..." }` |

## 6. Възможности за развитие
- **Преструктуриране на Frontend** – отделяне на `style.css` и `script.js` за по-добра организация.
- **Система за статуси/тагове** – маркиране на разговори с тагове („Нова поръчка“, „Изпратен“, „Рекламация“) и филтриране по тях.
- **Търсене и филтриране** – поле за търсене на разговори по име на потребител или обява.
- **Подобрения в интерфейса** – показване на информация за обявата в списъка с разговори.
- **Real-time обновяване** – изследване на възможности за WebSockets вместо ръчно натискане на „Обнови“.

## 7. Политика за поверителност
Подробна информация за обработката на данни е налична в [privacy.html](privacy.html).

