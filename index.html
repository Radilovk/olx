<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>OLX Dashboard</title>
    <style>
        body { font-family: sans-serif; display: flex; }
        #sidebar { width: 300px; border-right: 1px solid #ccc; height: 100vh; overflow-y: auto; }
        #content { flex-grow: 1; padding: 20px; }
        .thread-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .thread-item:hover { background-color: #f0f0f0; }
        .thread-item.unread { font-weight: bold; }
        #loader { text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Разговори</h2>
        <div id="loader">Зареждам...</div>
        <div id="threads-list"></div>
    </div>

    <div id="content">
        <h1>Добре дошли в контролния панел</h1>
        <p>Изберете разговор отляво, за да видите съобщенията.</p>
        <div id="messages-view"></div>
    </div>

    <script>
        // Когато страницата зареди, извикваме функцията за зареждане на чатовете
        document.addEventListener('DOMContentLoaded', fetchThreads);

        async function fetchThreads() {
            const listContainer = document.getElementById('threads-list');
            const loader = document.getElementById('loader');
            
            try {
                // Правим заявка към нашия Worker API
                const response = await fetch('https://olx.radilov-k.workers.dev/api/threads');
                
                if (!response.ok) {
                    // Ако има грешка (например токенът е изтекъл), показваме я
                    const errorData = await response.json();
                    listContainer.innerHTML = `<p style="color: red;">Грешка: ${errorData.error}</p><p>Моля, <a href="[ТУК СЛОЖИ ЛИНКА ЗА ОТОРИЗАЦИЯ ОТ СТАРИЯ HTML]">оторизирайте се отново</a>.</p>`;
                    return;
                }

                const threads = await response.json();

                if (threads.length === 0) {
                    listContainer.innerHTML = '<p>Няма намерени разговори.</p>';
                    return;
                }

                // Изчистваме списъка и го попълваме с новите данни
                listContainer.innerHTML = ''; 
                threads.forEach(thread => {
                    const threadElement = document.createElement('div');
                    threadElement.className = 'thread-item';
                    if (thread.unread_count > 0) {
                        threadElement.classList.add('unread');
                    }
                    
                    // Засега показваме само ID-то. По-късно можем да добавим име на обявата и т.н.
                    threadElement.innerHTML = `
                        <p>Чат ID: ${thread.id}</p>
                        <small>Непрочетени: ${thread.unread_count}</small>
                    `;
                    
                    // Добавяме event listener, за да можем по-късно да зареждаме съобщенията
                    threadElement.addEventListener('click', () => {
                        // Тук ще добавим логика за показване на съобщенията
                        document.getElementById('content').innerHTML = `<h1>Разговор ${thread.id}</h1><p>Тук ще се покажат съобщенията...</p>`;
                    });

                    listContainer.appendChild(threadElement);
                });

            } catch (error) {
                listContainer.innerHTML = `<p style="color: red;">Възникна мрежова грешка: ${error.message}</p>`;
            } finally {
                // Скриваме индикатора за зареждане
                loader.style.display = 'none';
            }
        }
    </script>
</body>
</html>```

### Какво да направиш сега:

1.  **Актуализирай `worker.js`** в Cloudflare с новия код, който има `/api/threads` път. Не забравяй да копираш и старите функции в него.
2.  **Актуализирай `index.html`** в GitHub с новия код за интерфейса. **Внимание:** В `<a>` тага за ре-оторизация трябва да сложиш правилния `href` от предишния `index.html` файл.
3.  Разгърни промените и отвори `https://radilovk.github.io/olx`.

Ако всичко е наред, вместо бутон, вече трябва да видиш прост интерфейс, който се опитва да зареди твоите OLX разговори в лявата колона.

Това е първата голяма стъпка към системата, която искаш. Когато това заработи, можем да добавим функционалност за показване на съобщенията в даден чат и поле за отговор.
